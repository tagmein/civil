{
 "type": "script",
 "instructions": [
  {
   "type": "action",
   "function": "setProperty",
   "arguments": ["host"],
   "value": "localhost"
  },
  {
   "type": "action",
   "function": "setProperty",
   "arguments": ["port"],
   "value": {
    "type": "invokeAction",
    "value": {
     "type": "action",
     "function": "invokeMethod",
     "arguments": ["global", "parseInt"],
     "value": [
      {
       "type": "invokeAction",
       "value": {
        "type": "action",
        "function": "defaultValue",
        "arguments": ["8080"],
        "value": {
         "type": "action",
         "function": "extractProperty",
         "arguments": ["global", "process", "env", "PORT"]
        }
       }
      },
      10
     ]
    }
   }
  },
  {
   "type": "branch",
   "script": {
    "type": "script",
    "instructions": [
     {
      "type": "action",
      "function": "setProperty",
      "arguments": ["responseAction"],
      "value": {
       "arguments": [
        {
         "title": "req",
         "type": "object"
        },
        {
         "title": "res",
         "type": "object"
        }
       ],
       "returnType": "void",
       "implementation": [
        {
         "type": "action",
         "function": "setProperty",
         "arguments": [
          {
           "type": "argumentReference",
           "index": 1
          },
          "statusCode"
         ],
         "value": 200
        },
        {
         "type": "action",
         "function": "invokeMethod",
         "arguments": [
          {
           "type": "argumentReference",
           "index": 1
          },
          "setHeader"
         ],
         "value": ["Content-Type", "text/plain"]
        },
        {
         "type": "action",
         "function": "invokeMethod",
         "arguments": [
          {
           "type": "argumentReference",
           "index": 1
          },
          "end"
         ],
         "value": ["Hello, World!\n"]
        }
       ]
      }
     }
    ]
   }
  },
  {
   "type": "branch",
   "script": {
    "type": "script",
    "instructions": [
     {
      "type": "action",
      "function": "setProperty",
      "arguments": ["server"],
      "value": {
       "type": "invokeAction",
       "value": {
        "type": "action",
        "function": "invokeMethod",
        "arguments": ["http", "createServer"],
        "value": [
         {
          "type": "actionFunction",
          "value": {
           "type": "action",
           "function": "extractProperty",
           "arguments": ["responseAction"]
          }
         }
        ]
       }
      }
     }
    ]
   }
  },
  {
   "type": "branch",
   "script": {
    "type": "script",
    "instructions": [
     {
      "type": "action",
      "function": "invokeMethod",
      "arguments": ["server", "listen"],
      "value": [
       {
        "type": "action",
        "function": "extractProperty",
        "arguments": ["port"]
       },
       {
        "type": "action",
        "function": "extractProperty",
        "arguments": ["host"]
       },
       {
        "type": "actionFunction",
        "value": {
         "type": "action",
         "function": "invokeMethod",
         "arguments": ["global", "console", "log"],
         "value": [
          {
           "type": "template",
           "value": "Server running at http://{{host}}:{{port}}/"
          }
         ]
        }
       }
      ]
     }
    ]
   }
  }
 ]
}
